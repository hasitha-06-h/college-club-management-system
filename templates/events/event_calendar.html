{% extends "base.html" %}
{% load static %}

{% block title %}Event Calendar{% endblock %}

{% block extra_css %}
    {# --- EMBEDDED CSS FOR EVENT CALENDAR --- #}
    <style>
        /* General styling for the event calendar container */
        .event-calendar-container {
            padding: 40px 0;
            background-color: #f0f2f5; /* A slightly cooler light background */
        }

        /* Heading styling */
        .event-calendar-container h1 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 800; /* Extra bold */
            color: #2c3e50; /* Darker, professional blue-grey */
            margin-bottom: 40px;
            position: relative;
            text-align: center;
            padding-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .event-calendar-container h1::after {
            content: '';
            position: absolute;
            left: 50%;
            bottom: 0;
            transform: translateX(-50%);
            width: 100px;
            height: 5px;
            background-color: #3498db; /* A vibrant blue for accent */
            border-radius: 3px;
        }

        /* Search and Filter Form Styling */
        .event-calendar-container .search-filter-form {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.07);
            margin-bottom: 30px;
            display: flex; /* Ensures elements align nicely */
            gap: 10px; /* Space between form elements */
            flex-wrap: wrap; /* Allows wrapping on smaller screens */
        }

        .event-calendar-container .search-filter-form .form-control,
        .event-calendar-container .search-filter-form .form-select {
            border-radius: 8px;
            border: 1px solid #ced4da;
            padding: 10px 15px;
        }

        .event-calendar-container .search-filter-form .btn-outline-success {
            border-color: #28a745;
            color: #28a745;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        .event-calendar-container .search-filter-form .btn-outline-success:hover {
            background-color: #28a745;
            color: #fff;
        }

        /* Create New Event Button */
        .event-calendar-container .btn-primary {
            background-color: #007bff; /* Standard primary blue for main actions */
            border-color: #007bff;
            font-weight: 600;
            border-radius: 8px;
            padding: 10px 20px;
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }

        .event-calendar-container .btn-primary:hover {
            background-color: #0056b3;
            border-color: #0056b3;
        }

        /* Event Card Styling */
        .event-calendar-container .card {
            border: none;
            border-radius: 15px; /* Even more rounded corners */
            overflow: hidden;
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1); /* Stronger shadow */
            background-color: #fff;
            position: relative; /* For badges */
        }

        .event-calendar-container .card:hover {
            transform: translateY(-8px); /* More pronounced lift effect */
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.2);
        }

        /* Highlight for today's events */
        .event-calendar-container .card.border-primary {
            border: 3px solid #3498db !important; /* Emphasize today's events */
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
        }

        .event-calendar-container .card-body {
            padding: 25px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 180px; /* Ensure consistent height for cards */
        }

        .event-calendar-container .card-title {
            font-size: 1.6rem;
            color: #34495e; /* Darker blue-grey for titles */
            font-weight: 700;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .event-calendar-container .card-subtitle {
            font-size: 0.9rem;
            color: #7f8c8d; /* Muted grey for subtitle */
            margin-bottom: 15px;
            line-height: 1.5;
            display: flex;
            flex-wrap: wrap; /* Allow wrapping for multiple info spans */
            gap: 10px; /* Space between info items */
        }

        .event-calendar-container .card-subtitle i {
            color: #3498db; /* Blue icons */
        }

        .event-calendar-container .card-text {
            color: #555;
            line-height: 1.6;
            margin-bottom: 20px;
            flex-grow: 1; /* Allows description to take available space */
        }

        .event-calendar-container .card-text small {
            font-style: italic;
            color: #888;
        }

        /* Event Badges */
        .event-calendar-container .badge {
            font-size: 0.8rem;
            padding: 0.5em 0.9em;
            border-radius: 50px; /* Pill-shaped badges */
            font-weight: 600;
            text-transform: uppercase;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .event-calendar-container .badge.bg-secondary { /* Past Event */
            background-color: #95a5a6 !important; /* Muted grey */
        }
        .event-calendar-container .badge.bg-primary { /* Happening Today */
            background-color: #e74c3c !important; /* Red for urgency */
        }
        .event-calendar-container .badge.bg-info { /* Upcoming */
            background-color: #2ecc71 !important; /* Green for positive/future */
        }

        /* Action Buttons within card */
        .event-calendar-container .btn-outline-info {
            border-color: #3498db;
            color: #3498db;
            transition: all 0.3s ease;
        }
        .event-calendar-container .btn-outline-info:hover {
            background-color: #3498db;
            color: #fff;
        }

        .event-calendar-container .btn-outline-secondary {
            border-color: #7f8c8d;
            color: #7f8c8d;
            transition: all 0.3s ease;
        }
        .event-calendar-container .btn-outline-secondary:hover {
            background-color: #7f8c8d;
            color: #fff;
        }

        .event-calendar-container .btn-outline-danger {
            border-color: #e74c3c;
            color: #e74c3c;
            transition: all 0.3s ease;
        }
        .event-calendar-container .btn-outline-danger:hover {
            background-color: #e74c3c;
            color: #fff;
        }

        /* No events message */
        .event-calendar-container .lead {
            color: #7f8c8d;
            margin-top: 50px;
            font-size: 1.25rem;
        }

        /* Pagination Styling */
        .pagination .page-item .page-link {
            color: #3498db;
            border-color: #bdc3c7;
            border-radius: 5px;
            margin: 0 3px;
            transition: all 0.3s ease;
        }

        .pagination .page-item .page-link:hover {
            background-color: #ecf0f1;
            border-color: #3498db;
        }

        .pagination .page-item.active .page-link {
            background-color: #3498db;
            border-color: #3498db;
            color: white;
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.4);
        }
        .pagination .page-item.disabled .page-link {
            color: #b0b0b0;
            background-color: #e9ecef;
            border-color: #dee2e6;
        }
        /* Adding a Google Font - make sure to link this in your base.html head */
        /* <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet"> */
    </style>
    {# --- END EMBEDDED CSS --- #}
{% endblock %}

{% block content %}
<div class="container py-5 event-calendar-container"> {# <--- ADDED THE CLASS HERE #}
    <h1 class="mb-4 text-center">Upcoming Events</h1>

    <div class="d-flex justify-content-between align-items-center mb-4 search-filter-form"> {# <--- ADDED THE CLASS HERE #}
        {# Optional: Search and Filter Form #}
        <form class="d-flex flex-grow-1 me-2" method="GET"> {# Added flex-grow-1 #}
            <input class="form-control me-2" type="search" placeholder="Search events..." aria-label="Search" name="q" value="{{ request.GET.q }}">
            <select class="form-select me-2" name="club">
                <option value="">Filter by Club</option>
                {% comment %}
                You need to ensure 'request.user.joined_clubs.all' and 'all_clubs' are passed from your EventListView context.
                For demonstration, I'm assuming 'all_clubs' is available if user is admin/manager.
                {% endcomment %}
                {% for club_filter in all_clubs %} {# Changed to loop through all_clubs, assuming it's passed #}
                    <option value="{{ club_filter.slug }}" {% if request.GET.club == club_filter.slug %}selected{% endif %}>{{ club_filter.title }}</option>
                {% endfor %}
            </select>
            <button class="btn btn-outline-success" type="submit">Apply Filters</button>
        </form>

        {% if user.is_authenticated and user.user_type in 'college_admin' or user.user_type == 'club_manager' %}
        <a href="{% url 'event_create' %}" class="btn btn-primary">Create New Event</a>
        {% endif %}
    </div>

    {% if events %}
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4"> {# Responsive grid for cards #}
        {% for event in events %}
        <div class="col">
            <div class="card shadow-sm {% if event.date == today %}border-primary{% endif %}">
                <div class="card-body">
                    <h5 class="card-title d-flex justify-content-between align-items-center">
                        <span>{{ event.title }}</span>
                        {% if event.is_past_event %}
                            <span class="badge bg-secondary">Past Event</span>
                        {% elif event.date == today %}
                            <span class="badge bg-primary">Happening Today!</span>
                        {% else %}
                            <span class="badge bg-info">Upcoming</span>
                        {% endif %}
                    </h5>
                    <h6 class="card-subtitle mb-2 text-muted">
                        <i class="bi bi-calendar-event me-1"></i>{{ event.get_display_date }}
                        {% if event.time %}<span class="ms-3"><i class="bi bi-clock me-1"></i>{{ event.get_display_time }}</span>{% endif %}
                        {% if event.location %}<span class="ms-3"><i class="bi bi-geo-alt me-1"></i>{{ event.location }}</span>{% endif %}
                    </h6>
                    <p class="card-text">{{ event.description|truncatechars:200 }}</p>
                    {% if event.club %}
                        <p class="card-text"><small class="text-muted">Hosted by: <a href="{% url 'club_detail' event.club.slug %}">{{ event.club.title }}</a></small></p>
                    {% endif %}
                    <div class="d-flex justify-content-between align-items-center mt-auto"> {# mt-auto pushes to bottom #}
                        <a href="{% url 'event_detail' event.pk %}" class="btn btn-outline-info btn-sm">View Details</a>
                        {# Optional: Edit/Delete buttons for authorized users #}
                        {% if user.is_authenticated %}
                            {% if user.user_type == 'college_admin' or user == event.created_by %}
                                <a href="{% url 'event_update' event.pk %}" class="btn btn-outline-secondary btn-sm ms-2">Edit</a>
                            {% endif %}
                            {% if user.is_college_admin %}
                                <a href="{% url 'event_delete' event.pk %}" class="btn btn-outline-danger btn-sm ms-2">Delete</a>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    {# Pagination controls #}
    {% if is_paginated %}
    <nav aria-label="Event pagination" class="mt-4">
        <ul class="pagination justify-content-center">
            {% if page_obj.has_previous %}
                <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">Previous</a></li>
            {% else %}
                <li class="page-item disabled"><span class="page-link">Previous</span></li>
            {% endif %}

            {% for i in paginator.page_range %}
                {% if page_obj.number == i %}
                    <li class="page-item active"><span class="page-link">{{ i }}</span></li>
                {% else %}
                    <li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
                {% endif %}
            {% endfor %}

            {% if page_obj.has_next %}
                <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">Next</a></li>
            {% else %}
                <li class="page-item disabled"><span class="page-link">Next</span></li>
            {% endif %}
        </ul>
    </nav>
    {% endif %}

    {% else %}
    <p class="text-center lead">No upcoming events found. Check back later!</p>
    {% endif %}
</div>
{% endblock %}